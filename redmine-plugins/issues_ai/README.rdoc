= issues_ai

Use AI to review the Issues before submitting them.
Helps write better Bug reports and Feature requests.

== Installation

First add 'ruby-openai' to your Gemfile.local and run 'bundle install'.

Redmine does not offer all the hooks needed, so here are a couple of manual patches:

- Add the following at line 40 of `app/views/repositories/_changeset.html.erb`:
```
<!-- CUSTOM INSERTED CODE -->
<div>
    <h3>AI Code Review</h3>
    <% begin %>
        <%if @changeset.has_code_review_results? %>
            <%= textilizable(@changeset.code_review_results) %>
        <%elsif @changeset.has_code_review_queued? %>
            Pending AI Code Review ... (please check again in a few minutes)
        <%else%>
            <%= link_to 'Queue an AI Code Review', '/issues_ai/queue_review?commit=' + @changeset.identifier %>
        <%end%>
        <%= form_tag '/issues_ai/code_review_commit', method: :post do %>
            <%= hidden_field_tag 'hash', @changeset.identifier %>
            <%= submit_tag 'Review Now' %>
        <% end %>
    <% rescue => e%>
        <div>Exception in erb template: <%= e %></div>
    <% end %>
</div>
<!-- /CUSTOM INSERTED CODE -->
```

- Add the following at the end of `app/views/issues/tabs/_changesets.html.erb`:
```
<%= call_hook(:view_issues_history_changesets_bottom, { :changesets => @changesets }) %>
```

== Configuration

Go to the plugin settings page and add your API urls, keys and default models.
Then setup the prompts you want to use, see the prompts directory for examples.

API Url:: The base URL of the OpenAI compatible API, e.g. 'https://api.openai.com/v1'
API Key:: The API key to use for authentication
Model:: The default model to use for the AI requests
Tool Model:: The model to use for tool invocation, usually OpenAI model work better here
Temperature:: Optional: Override the Model default temperature, see for example: https://platform.openai.com/docs/api-reference/chat#chat-create-temperature
Max Tokens:: Optional: Limit the amount of output tokens, see https://platform.openai.com/docs/api-reference/chat#chat-create-max_tokens
Default Prompt:: The default prompt to use for evaluating the Issue content, the other prompt are for each specific Issue type
Code Review Prompts:: Links to a page where the prompts for code reviews can be configured for each Repository setup in Redmine

== Usage

=== Reviewing an Issue

On the New Issue page, you will see a new button 'Evaluate with AI' that will give
suggestions on how to improve the issue description based on the type of issue (Bug or Feature)
and the prompts that are configured.

=== Ask AI

Go to the `/issues_ai/ask` page for an interface to ask free questions. This supports injecting
issues and wiki pages as context in the following way:
- `[Some_Page]` will inject the content of the wiki page named 'Some Page'.
- `#123` will inject the content of issue 123,
- issues injected will be including ID / Subject / Description / Tracker / Status / Created Date / Assigned
- issues can also be injected based on natural language queries like 'new feature issues over the last month'
